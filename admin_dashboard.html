<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R.A.S.T.E.R. Operations - Game Sessions</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-blood-red: #dc143c;
            --color-dark-red: #8b0000;
            --color-near-black: #0a0a0a;
            --color-dark-gray: #1a1a1a;
            --color-off-white: #e0e0e0;
            --color-text-dim: rgba(224, 224, 224, 0.7);
            --color-text-faint: rgba(224, 224, 224, 0.5);
            --color-text-ghost: rgba(224, 224, 224, 0.3);
            --color-border-red: rgba(220, 20, 60, 0.5);
            --color-border-bright: rgba(220, 20, 60, 0.8);
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --font-ocr: 'Share Tech Mono', 'Courier New', monospace;
            --font-din: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        body {
            font-family: var(--font-din);
            background: var(--color-near-black);
            color: var(--color-off-white);
            padding: 20px;
            min-height: 100vh;
        }

        /* VHS SCANLINES - REQUIRED */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 9999;
            animation: scanlines 8s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: var(--color-dark-gray);
            padding: 25px 30px;
            border-radius: 0;
            margin-bottom: 30px;
            border: 1px solid var(--color-border-red);
            border-left: 3px solid var(--color-blood-red);
        }

        h1 {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-size: 1.5rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            font-weight: normal;
            margin-bottom: 10px;
            text-shadow: none;
        }

        .subtitle {
            font-family: var(--font-ocr);
            color: var(--color-text-faint);
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--color-dark-gray);
            backdrop-filter: none;
            padding: 20px;
            border-radius: 0;
            border: 1px solid var(--color-border-red);
            box-shadow: none;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--color-blood-red);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.15),
                        -3px 0 0 rgba(220, 20, 60, 0.3),
                        3px 0 0 rgba(220, 20, 60, 0.2);
        }

        .stat-label {
            font-family: var(--font-ocr);
            color: var(--color-text-faint);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-family: var(--font-ocr);
            font-size: 2rem;
            font-weight: normal;
            color: var(--color-blood-red);
            letter-spacing: 0.1em;
        }

        .stat-value.warning {
            color: var(--color-warning);
        }

        .tab-button {
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--color-text-dim);
            padding: 15px 30px;
            font-family: var(--font-ocr);
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            color: var(--color-off-white);
            background: rgba(220, 20, 60, 0.05);
        }

        .tab-button.active {
            color: var(--color-blood-red);
            border-bottom-color: var(--color-blood-red);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stat-value.danger {
            color: var(--color-blood-red);
        }

        .sessions-section {
            background: var(--color-dark-gray);
            backdrop-filter: none;
            padding: 30px;
            border-radius: 0;
            border: 1px solid var(--color-border-red);
            border-left: 3px solid var(--color-blood-red);
            box-shadow: none;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            font-weight: normal;
            margin-bottom: 8px;
        }

        .last-updated {
            font-family: var(--font-ocr);
            color: var(--color-text-faint);
            font-size: 0.65rem;
            letter-spacing: 0.1em;
        }

        h2, h3, h4 {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            font-weight: normal;
        }

        .section-title {
            font-size: 1.8em;
            color: #fff;
        }

        .btn {
            font-family: var(--font-ocr);
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 8px 16px;
            border: 1px solid var(--color-border-red);
            border-radius: 0;
            background: transparent;
            color: var(--color-off-white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: normal;
        }

        .btn:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--color-blood-red);
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.3);
            color: var(--color-blood-red);
            text-shadow: -2px 0 0 rgba(220, 20, 60, 0.5),
                         2px 0 0 rgba(220, 20, 60, 0.3);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--color-blood-red);
            border-color: var(--color-blood-red);
            color: var(--color-near-black);
        }

        .btn-primary:hover {
            background: var(--color-dark-red);
            border-color: var(--color-dark-red);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
            color: var(--color-near-black);
            text-shadow: none;
        }

        .btn-danger {
            background: transparent;
            border-color: var(--color-blood-red);
            color: var(--color-blood-red);
            padding: 8px 16px;
            font-size: 0.75rem;
        }

        .btn-danger:hover {
            background: var(--color-blood-red);
            color: var(--color-near-black);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
            text-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            border-color: var(--color-border-red);
            color: var(--color-text-dim);
            padding: 8px 16px;
            font-size: 0.75rem;
        }

        .btn-secondary:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--color-blood-red);
            color: var(--color-blood-red);
        }

        .sessions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-family: var(--font-ocr);
            font-size: 0.75rem;
        }

        .sessions-table th {
            background: rgba(220, 20, 60, 0.1);
            padding: 12px 16px;
            text-align: left;
            font-weight: normal;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--color-blood-red);
            border-bottom: 2px solid var(--color-blood-red);
        }

        .sessions-table td {
            padding: 10px 16px;
            border-bottom: 1px solid rgba(220, 20, 60, 0.2);
            color: var(--color-text-dim);
        }

        .sessions-table tbody tr {
            transition: background 0.2s ease;
        }

        .sessions-table tbody tr:hover {
            background: rgba(220, 20, 60, 0.05);
            cursor: pointer;
        }

        .sessions-table tbody tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.2);
        }

        .sessions-table tbody tr:nth-child(even):hover {
            background: rgba(220, 20, 60, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 2px;
            font-size: 0.65rem;
            font-weight: normal;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            border: 1px solid;
        }

        .status-alive {
            background: rgba(76, 175, 80, 0.1);
            color: var(--color-success);
            border-color: var(--color-success);
        }

        .status-dead {
            background: rgba(220, 20, 60, 0.1);
            color: var(--color-blood-red);
            border-color: var(--color-blood-red);
        }

        .session-actions {
            display: flex;
            gap: 10px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 40px;
            font-family: var(--font-ocr);
            font-size: 0.85rem;
            letter-spacing: 0.2em;
            color: var(--color-blood-red);
            text-transform: uppercase;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .error {
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--color-blood-red);
            border-left: 3px solid var(--color-blood-red);
            color: var(--color-blood-red);
            padding: 15px;
            border-radius: 0;
            margin: 20px 0;
            font-family: var(--font-ocr);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
        }

        .success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--color-success);
            border-left: 3px solid var(--color-success);
            color: var(--color-success);
            padding: 15px;
            border-radius: 0;
            font-family: var(--font-ocr);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            margin: 20px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--color-dark-gray);
            padding: 30px;
            border-radius: 0;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--color-border-red);
            border-left: 3px solid var(--color-blood-red);
            box-shadow: 0 0 30px rgba(220, 20, 60, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border-red);
        }

        .modal-title {
            font-family: var(--font-ocr);
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--color-blood-red);
            font-weight: normal;
        }

        .close-btn {
            background: none;
            border: 1px solid var(--color-border-red);
            color: var(--color-text-faint);
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--color-blood-red);
            border-color: var(--color-blood-red);
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.3);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(220, 20, 60, 0.2);
        }

        .detail-label {
            font-family: var(--font-ocr);
            color: var(--color-text-faint);
            font-weight: normal;
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .detail-value {
            font-family: var(--font-ocr);
            color: var(--color-text-dim);
            font-size: 0.75rem;
        }

        .detail-value {
            color: #fff;
            text-align: right;
        }

        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #888;
        }

        .auto-refresh input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .last-updated {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .tape-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0;
            border: 1px solid var(--color-border-red);
            text-align: center;
        }

        .tape-container img {
            max-width: 100%;
            border-radius: 0;
            border: 1px solid var(--color-border-red);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.2);
        }

        .tape-container h4 {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            margin-bottom: 10px;
        }

        .tape-list {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .tape-item {
            font-family: var(--font-ocr);
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            background: transparent;
            padding: 8px 12px;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--color-border-red);
            color: var(--color-text-dim);
        }

        .tape-item:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--color-blood-red);
            color: var(--color-blood-red);
            transform: translateY(-2px);
        }

        .tape-item.active {
            background: rgba(220, 20, 60, 0.2);
            border-color: var(--color-blood-red);
            color: var(--color-blood-red);
        }

        .no-tapes {
            font-family: var(--font-ocr);
            color: var(--color-text-faint);
            font-style: normal;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            padding: 20px;
            text-transform: uppercase;
        }

        /* History Viewer Styles */
        .history-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border-red);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            font-weight: normal;
        }

        .history-controls {
            display: flex;
            gap: 10px;
        }

        .expand-all-btn,
        .collapse-all-btn {
            font-family: var(--font-ocr);
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 6px 12px;
            border: 1px solid var(--color-border-red);
            background: transparent;
            color: var(--color-text-dim);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expand-all-btn:hover,
        .collapse-all-btn:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--color-blood-red);
            color: var(--color-blood-red);
        }

        .history-entry {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--color-blood-red);
            border: 1px solid var(--color-border-red);
            border-left: 3px solid var(--color-blood-red);
            margin-bottom: 15px;
            border-radius: 0;
            overflow: hidden;
        }

        .history-entry-header {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            transition: background 0.2s;
        }

        .history-entry-header:hover {
            background: rgba(220, 20, 60, 0.1);
        }

        .history-entry-title {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-weight: normal;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
        }

        .history-entry-meta {
            font-family: var(--font-ocr);
            font-size: 0.65rem;
            color: var(--color-text-faint);
        }

        .history-expand-icon {
            font-family: monospace;
            color: var(--color-text-faint);
            transition: transform 0.3s ease;
        }

        .history-entry.expanded .history-expand-icon {
            transform: rotate(90deg);
        }

        .history-entry-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .history-entry.expanded .history-entry-content {
            max-height: 3000px;
            padding: 15px;
        }

        .history-entry.expanded .history-entry-header {
            border-bottom: 1px solid var(--color-border-red);
        }

        .history-detail {
            margin-bottom: 15px;
        }

        .history-detail-label {
            font-family: var(--font-ocr);
            color: var(--color-blood-red);
            font-weight: normal;
            margin-bottom: 5px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .history-detail-value {
            font-family: var(--font-din);
            color: var(--color-text-dim);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-left: 2px solid var(--color-border-red);
            line-height: 1.6;
            font-size: 0.85rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-detail-value.json {
            max-height: 400px;
        }

        .history-image-link {
            color: #4ecdc4;
            text-decoration: none;
            font-style: italic;
        }

        .history-image-link:hover {
            text-decoration: underline;
        }

        .history-expand-icon {
            transition: transform 0.3s;
            font-size: 1.2em;
        }

        .history-entry.expanded .history-expand-icon {
            transform: rotate(90deg);
        }

        .history-loading,
        .history-empty {
            font-family: var(--font-ocr);
            text-align: center;
            padding: 30px;
            color: var(--color-text-faint);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .history-empty {
            text-align: center;
            padding: 30px;
            color: #888;
            font-style: italic;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .expand-all-btn, .collapse-all-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
        }

        .expand-all-btn:hover, .collapse-all-btn:hover {
            background: rgba(78, 205, 196, 0.3);
        }

        /* JSON Syntax Highlighting (basic) */
        .json-key {
            color: var(--color-blood-red);
        }

        .json-string {
            color: var(--color-text-dim);
        }

        .json-number {
            color: var(--color-success);
        }

        .json-boolean {
            color: var(--color-warning);
        }

        .json-null {
            color: var(--color-text-ghost);
        }

        .json {
            font-family: var(--font-ocr);
            font-size: 0.7rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .refreshing {
            animation: pulse 1s ease-in-out infinite;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            header {
                padding: 15px 20px;
            }

            h1 {
                font-size: 1.2rem;
                letter-spacing: 0.2em;
            }

            .subtitle {
                font-size: 0.6rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .sessions-section {
                padding: 20px;
            }

            .sessions-table {
                font-size: 0.65rem;
            }

            .sessions-table th,
            .sessions-table td {
                padding: 8px 10px;
            }

            .btn {
                font-size: 0.65rem;
                padding: 6px 12px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ SOMEWHERE - Admin Dashboard</h1>
            <p class="subtitle">Real-time game monitoring & session management</p>
        </header>

        <div id="error-message"></div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Sessions</div>
                <div class="stat-value" id="total-sessions">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Players</div>
                <div class="stat-value" id="active-players">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Deaths Today</div>
                <div class="stat-value danger" id="deaths-today">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Turns</div>
                <div class="stat-value" id="total-turns">-</div>
            </div>
        </div>

        <!-- TABS -->
        <div style="display: flex; gap: 0; border-bottom: 1px solid var(--color-border-red); margin-bottom: 30px;">
            <button id="tab-sessions" class="tab-button active" onclick="switchTab('sessions')">
                ACTIVE SESSIONS
            </button>
            <button id="tab-archives" class="tab-button" onclick="switchTab('archives')">
                ARCHIVES
            </button>
        </div>

        <!-- ACTIVE SESSIONS TAB -->
        <div id="tab-content-sessions" class="tab-content active">
            <div class="sessions-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Active Sessions</h2>
                        <div class="last-updated" id="last-updated">Last updated: Never</div>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div class="auto-refresh">
                            <input type="checkbox" id="auto-refresh" checked>
                            <label for="auto-refresh">Auto-refresh (5s)</label>
                        </div>
                        <button class="btn btn-primary" onclick="refreshData()">‚Üª Refresh</button>
                        <button class="btn btn-primary" onclick="showCreateSession()">+ New Session</button>
                    </div>
                </div>

                <div id="sessions-loading" class="loading">Loading sessions...</div>
                <div id="sessions-container"></div>
            </div>
        </div>

        <!-- ARCHIVES TAB -->
        <div id="tab-content-archives" class="tab-content" style="display: none;">
            <div class="sessions-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Archived Games</h2>
                        <div class="last-updated" id="archives-last-updated">Last updated: Never</div>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <button class="btn btn-primary" onclick="refreshArchives()">‚Üª Refresh</button>
                    </div>
                </div>

                <div id="archives-loading" class="loading">Loading archives...</div>
                <div id="archives-container"></div>
            </div>
        </div>
    </div>

    <!-- Session Details Modal -->
    <div id="session-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Session Details</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Auto-detect API base URL (use same origin as the dashboard)
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5001/api'  // Local development
            : `${window.location.protocol}//${window.location.host}/api`;  // Production (Render)
        
        console.log('[DASHBOARD] API Base URL:', API_BASE);
        
        let autoRefreshInterval = null;
        let sessionsData = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
            setupAutoRefresh();
        });

        // Setup auto-refresh
        function setupAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            
            if (checkbox.checked) {
                startAutoRefresh();
            }
            
            checkbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            autoRefreshInterval = setInterval(refreshData, 5000);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        // Main refresh function
        async function refreshData() {
            const refreshBtn = document.querySelector('.btn-primary');
            if (refreshBtn) refreshBtn.classList.add('refreshing');
            
            try {
                console.log('[DASHBOARD] Fetching sessions from:', `${API_BASE}/sessions`);
                const response = await fetch(`${API_BASE}/sessions`);
                
                console.log('[DASHBOARD] Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('[DASHBOARD] Error response:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('[DASHBOARD] Sessions loaded:', result.data?.length || 0);
                
                sessionsData = result.data || [];
                
                updateStats(sessionsData);
                renderSessions(sessionsData);
                updateLastUpdated();
                clearError();
                
            } catch (error) {
                console.error('[DASHBOARD] Failed to load sessions:', error);
                showError(`Failed to load sessions: ${error.message}`);
            } finally {
                if (refreshBtn) refreshBtn.classList.remove('refreshing');
            }
        }

        // Update statistics
        function updateStats(sessions) {
            const totalSessions = sessions.length;
            const activePlayers = sessions.filter(s => s.player_alive).length;
            const deathsToday = sessions.filter(s => !s.player_alive && isToday(s.last_accessed)).length;
            const totalTurns = sessions.reduce((sum, s) => sum + (s.turn_count || 0), 0);

            document.getElementById('total-sessions').textContent = totalSessions;
            document.getElementById('active-players').textContent = activePlayers;
            document.getElementById('deaths-today').textContent = deathsToday;
            document.getElementById('total-turns').textContent = totalTurns;
        }

        // Render sessions table
        function renderSessions(sessions) {
            const container = document.getElementById('sessions-container');
            const loading = document.getElementById('sessions-loading');
            
            loading.style.display = 'none';
            
            if (sessions.length === 0) {
                container.innerHTML = '<div class="loading">No active sessions</div>';
                return;
            }

            const table = `
                <table class="sessions-table">
                    <thead>
                        <tr>
                            <th>Session Name</th>
                            <th>ID</th>
                            <th>Status</th>
                            <th>Turns</th>
                            <th>Last Active</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sessions.map(session => renderSessionRow(session)).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // Render single session row
        function renderSessionRow(session) {
            const statusClass = session.player_alive ? 'status-alive' : 'status-dead';
            const statusText = session.player_alive ? 'Alive' : 'Dead';
            const shortId = session.session_id.substring(0, 8);
            const timeAgo = getTimeAgo(session.last_accessed);

            return `
                <tr>
                    <td><strong>${escapeHtml(session.name || 'Unnamed')}</strong></td>
                    <td><code>${shortId}...</code></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${session.turn_count || 0}</td>
                    <td>${timeAgo}</td>
                    <td>
                        <div class="session-actions">
                            <button class="btn btn-secondary" onclick="viewSession('${session.session_id}')" title="View session details and tapes">
                                üìº View
                            </button>
                            ${session.session_id !== 'default' ? 
                                `<button class="btn btn-danger" onclick="deleteSession('${session.session_id}', '${escapeHtml(session.name || 'Unnamed')}')">
                                    Delete
                                </button>` : 
                                '<span style="color: #666; font-size: 0.9em;">Protected</span>'
                            }
                        </div>
                    </td>
                </tr>
            `;
        }

        // View session details
        async function viewSession(sessionId) {
            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}`);
                if (!response.ok) throw new Error('Failed to fetch session details');
                
                const result = await response.json();
                const session = result.data;
                
                showSessionModal(session);
            } catch (error) {
                showError(`Failed to load session details: ${error.message}`);
            }
        }

        // Show session modal
        async function showSessionModal(session) {
            const meta = session.metadata;
            const state = session.state;
            
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Session ID</span>
                    <span class="detail-value"><code>${meta.session_id}</code></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Name</span>
                    <span class="detail-value">${escapeHtml(meta.name || 'Unnamed')}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Description</span>
                    <span class="detail-value">${escapeHtml(meta.description || 'No description')}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Created</span>
                    <span class="detail-value">${formatDate(meta.created_at)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Last Accessed</span>
                    <span class="detail-value">${formatDate(meta.last_accessed)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Turn Count</span>
                    <span class="detail-value">${meta.turn_count || 0}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Player Status</span>
                    <span class="detail-value">
                        <span class="status-badge ${meta.player_alive ? 'status-alive' : 'status-dead'}">
                            ${meta.player_alive ? 'Alive' : 'Dead'}
                        </span>
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Location</span>
                    <span class="detail-value">${state.location || 'Unknown'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Time of Day</span>
                    <span class="detail-value">${state.time_of_day || 'Unknown'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">History Length</span>
                    <span class="detail-value">${session.history_length || 0} entries</span>
                </div>
                
                <!-- DISCOVERED ENTITIES - STANDALONE TOP-LEVEL SECTION -->
                ${state.seen_elements && state.seen_elements.length > 0 ? `
                <div style="margin-top: 20px; margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, rgba(220, 20, 60, 0.08) 0%, rgba(0, 0, 0, 0.3) 100%); border: 2px solid var(--color-blood-red); box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--color-border-red); padding-bottom: 10px;">
                        <div>
                            <div style="font-family: var(--font-ocr); color: var(--color-blood-red); font-size: 0.85rem; letter-spacing: 0.2em; text-transform: uppercase; text-shadow: 0 0 10px rgba(220, 20, 60, 0.5);">üì¶ DISCOVERED ENTITIES</div>
                            <div style="font-family: var(--font-din); color: var(--color-text-dim); font-size: 0.7rem; margin-top: 4px; letter-spacing: 0.05em;">Significant objects, characters, and landmarks encountered</div>
                        </div>
                        <div style="font-family: var(--font-ocr); color: var(--color-blood-red); font-size: 1.5rem; padding: 8px 16px; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--color-border-red);">
                            ${state.seen_elements.length}
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; padding: 5px;">
                        ${state.seen_elements.map((elem, idx) => `
                            <div style="
                                background: rgba(0, 0, 0, 0.6); 
                                border: 1px solid var(--color-border-red); 
                                padding: 12px 14px; 
                                font-size: 0.75rem; 
                                font-family: var(--font-ocr); 
                                color: var(--color-text-primary);
                                position: relative;
                                transition: all 0.2s ease;
                                cursor: default;
                                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                            "
                            onmouseover="this.style.background='rgba(220, 20, 60, 0.15)'; this.style.borderColor='var(--color-blood-red)'; this.style.boxShadow='0 0 15px rgba(220, 20, 60, 0.4)';"
                            onmouseout="this.style.background='rgba(0, 0, 0, 0.6)'; this.style.borderColor='var(--color-border-red)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.3)';"
                            >
                                <div style="position: absolute; top: 4px; right: 6px; font-size: 0.6rem; color: var(--color-blood-red); opacity: 0.5;">#${idx + 1}</div>
                                <div style="line-height: 1.4; padding-top: 8px;">${escapeHtml(elem)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="history-section" style="margin-top: 20px; margin-bottom: 20px;">
                    <div class="history-header">
                        <h3 class="history-title">üß† Persistent World Memory</h3>
                        <div class="history-controls">
                            <button class="expand-all-btn" onclick="toggleWorldMemory()">Toggle View</button>
                        </div>
                    </div>
                    <div id="world-memory-content" style="display: none;">
                        <!-- WORLD STATE -->
                        <div style="margin-bottom: 15px; padding: 15px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--color-border-red); border-left: 3px solid var(--color-blood-red);">
                            <div style="font-family: var(--font-ocr); color: var(--color-blood-red); font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 10px;">Current World State</div>
                            <div style="font-family: var(--font-din); color: var(--color-text-dim); line-height: 1.6; white-space: pre-wrap; font-size: 0.85rem;">
                                ${escapeHtml(state.world_prompt || 'No world state initialized')}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="tape-section" style="margin-top: 20px;">
                    <div style="text-align: center; color: #888;">Loading tapes...</div>
                </div>
                <div class="history-section" style="margin-bottom: 30px;">
                    <div class="history-header">
                        <h3 class="history-title">üåç World Evolution Buffer</h3>
                        <div class="history-controls">
                            <button class="expand-all-btn" onclick="toggleWorldEvolution()">Toggle View</button>
                        </div>
                    </div>
                    <div id="world-evolution-content" style="display: none;">
                        <div class="history-loading">Loading world evolution...</div>
                    </div>
                </div>
                <div class="history-section">
                    <div class="history-header">
                        <h3 class="history-title">üìú Full History & Prompts</h3>
                        <div class="history-controls">
                            <button class="expand-all-btn" onclick="expandAllHistory()">Expand All</button>
                            <button class="collapse-all-btn" onclick="collapseAllHistory()">Collapse All</button>
                        </div>
                    </div>
                    <div id="history-content">
                        <div class="history-loading">Loading history...</div>
                    </div>
                </div>
            `;
            
            document.getElementById('session-modal').classList.add('show');
            
            // Load tapes and history after modal is shown
            loadTapes(meta.session_id);
            loadFullHistory(meta.session_id);
        }

        // Load tapes for a session
        async function loadTapes(sessionId) {
            try {
                // Try to list tapes from the session directory
                // We'll make a request to check if tapes exist
                const tapeSection = document.getElementById('tape-section');
                
                // For now, we'll try to load a tape directly
                // In a real implementation, you'd have an endpoint that lists available tapes
                // Let's try to load common tape filenames
                const commonTapes = await findTapes(sessionId);
                
                if (commonTapes.length === 0) {
                    tapeSection.innerHTML = '<div class="no-tapes">No tapes available for this session</div>';
                    return;
                }
                
                // Display tapes
                let html = '<h3 style="color: #fff; margin-bottom: 15px;">üé¨ VHS Tapes</h3>';
                html += '<div class="tape-list">';
                
                commonTapes.forEach((tape, index) => {
                    html += `<div class="tape-item ${index === 0 ? 'active' : ''}" onclick="viewTape('${sessionId}', '${tape}')">
                        üìº ${tape}
                    </div>`;
                });
                
                html += '</div>';
                html += '<div id="tape-display" class="tape-container"></div>';
                
                tapeSection.innerHTML = html;
                
                // Auto-load first tape
                if (commonTapes.length > 0) {
                    viewTape(sessionId, commonTapes[0]);
                }
            } catch (error) {
                console.error('Error loading tapes:', error);
                document.getElementById('tape-section').innerHTML = '<div class="no-tapes">Error loading tapes</div>';
            }
        }

        // Find available tapes for a session
        async function findTapes(sessionId) {
            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}/tapes`);
                if (!response.ok) {
                    return [];
                }
                
                const result = await response.json();
                const tapes = result.data || [];
                
                // Return just the filenames
                return tapes.map(tape => tape.filename);
            } catch (error) {
                console.error('Error fetching tapes:', error);
                return [];
            }
        }

        // View a specific tape
        function viewTape(sessionId, tapeName) {
            const tapeDisplay = document.getElementById('tape-display');
            const tapeUrl = `${API_BASE}/sessions/${sessionId}/tapes/${tapeName}`;
            
            tapeDisplay.innerHTML = `
                <h4 style="color: #4ecdc4; margin-bottom: 10px;">üìº ${tapeName}</h4>
                <img src="${tapeUrl}" alt="VHS Tape" style="max-width: 100%; border-radius: 8px;">
                <p style="color: #888; margin-top: 10px; font-size: 0.9em;">
                    <a href="${tapeUrl}" download="${tapeName}" style="color: #4ecdc4; text-decoration: none;">
                        ‚¨áÔ∏è Download Tape
                    </a>
                </p>
            `;
            
            // Update active state
            document.querySelectorAll('.tape-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('session-modal').classList.remove('show');
        }

        // Delete session
        async function deleteSession(sessionId, sessionName) {
            if (!confirm(`Are you sure you want to delete "${sessionName}"?\n\nThis will permanently delete all data for this session.`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('Failed to delete session');
                
                const result = await response.json();
                showSuccess(`Session "${sessionName}" deleted (${result.data.files_deleted} files removed)`);
                refreshData();
            } catch (error) {
                showError(`Failed to delete session: ${error.message}`);
            }
        }

        // Create new session
        function showCreateSession() {
            const name = prompt('Enter session name:', 'New Game Session');
            if (!name) return;

            const description = prompt('Enter description (optional):', '');
            
            createSession(name, description);
        }

        async function createSession(name, description) {
            try {
                const response = await fetch(`${API_BASE}/sessions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                
                if (!response.ok) throw new Error('Failed to create session');
                
                const result = await response.json();
                showSuccess(`Session "${name}" created successfully!`);
                refreshData();
            } catch (error) {
                showError(`Failed to create session: ${error.message}`);
            }
        }

        // Utility functions
        function isToday(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return `${seconds}s ago`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateLastUpdated() {
            const now = new Date().toLocaleTimeString();
            document.getElementById('last-updated').textContent = `Last updated: ${now}`;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = `<div class="error">‚ö†Ô∏è ${message}</div>`;
            setTimeout(() => errorDiv.innerHTML = '', 5000);
        }

        function clearError() {
            document.getElementById('error-message').innerHTML = '';
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = `<div class="success">‚úì ${message}</div>`;
            setTimeout(() => errorDiv.innerHTML = '', 5000);
        }

        // =========================================================================
        // HISTORY INSPECTION
        // =========================================================================

        // Load full history for a session
        async function loadFullHistory(sessionId) {
            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}/history`);
                if (!response.ok) throw new Error('Failed to fetch history');
                
                const result = await response.json();
                const historyData = result.data;
                
                displayHistory(historyData.history, sessionId);
                displayWorldEvolution(historyData.history, sessionId);
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('history-content').innerHTML = 
                    '<div class="history-empty">Failed to load history</div>';
            }
        }

        // Display world evolution timeline
        function displayWorldEvolution(history, sessionId) {
            const worldContent = document.getElementById('world-evolution-content');
            
            if (!history || history.length === 0) {
                worldContent.innerHTML = '<div class="history-empty">No world evolution data yet</div>';
                return;
            }
            
            let html = '';
            
            // Extract world_prompt evolution from history
            history.forEach((entry, index) => {
                const turnNum = entry.turn_count || entry.turn || (index + 1);
                
                // Show world_prompt_after if available (this is the evolved state)
                const worldPrompt = entry.world_prompt_after || entry.world_prompt;
                
                if (!worldPrompt) return;
                
                html += `
                    <div style="margin-bottom: 25px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; border-left: 3px solid ${index === history.length - 1 ? '#4ecdc4' : '#666'};">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div style="font-weight: bold; color: ${index === history.length - 1 ? '#4ecdc4' : '#888'};">
                                ${index === history.length - 1 ? 'üî¥ CURRENT STATE' : 'üìç Turn ' + turnNum}
                            </div>
                            <div style="font-size: 0.9em; color: #666;">
                                ${entry.choice ? escapeHtml(entry.choice).substring(0, 40) + '...' : 'System Event'}
                            </div>
                        </div>
                        <div style="color: #e0e0e0; line-height: 1.6; white-space: pre-wrap;">
                            ${escapeHtml(worldPrompt)}
                        </div>
                    </div>
                `;
            });
            
            worldContent.innerHTML = html || '<div class="history-empty">No world evolution tracked</div>';
        }

        // Toggle world evolution view
        function toggleWorldEvolution() {
            const content = document.getElementById('world-evolution-content');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // Toggle world memory view
        function toggleWorldMemory() {
            const content = document.getElementById('world-memory-content');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // Display history entries
        function displayHistory(history, sessionId) {
            const historyContent = document.getElementById('history-content');
            
            if (!history || history.length === 0) {
                historyContent.innerHTML = '<div class="history-empty">No history entries yet</div>';
                return;
            }
            
            let html = '';
            
            // Reverse to show newest first
            const reversedHistory = [...history].reverse();
            
            reversedHistory.forEach((entry, index) => {
                const turnNum = entry.turn_count || entry.turn || (history.length - index);
                const entryId = `history-entry-${index}`;
                
                html += `
                    <div class="history-entry" id="${entryId}">
                        <div class="history-entry-header" onclick="toggleHistoryEntry('${entryId}')">
                            <div>
                                <div class="history-entry-title">
                                    Turn ${turnNum}: ${escapeHtml(entry.choice || entry.action || 'System Event')}
                                </div>
                                <div class="history-entry-meta">
                                    ${entry.timestamp ? formatDate(entry.timestamp) : 'No timestamp'}
                                </div>
                            </div>
                            <span class="history-expand-icon">‚ñ∂</span>
                        </div>
                        <div class="history-entry-content">
                            ${buildHistoryEntryDetails(entry, sessionId)}
                        </div>
                    </div>
                `;
            });
            
            historyContent.innerHTML = html;
        }

        // Build detailed view of a history entry
        function buildHistoryEntryDetails(entry, sessionId) {
            let html = '';
            
            // Player Action
            if (entry.choice || entry.action) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Player Action</div>
                        <div class="history-detail-value">${escapeHtml(entry.choice || entry.action)}</div>
                    </div>
                `;
            }
            
            // Narrative Dispatch (AI Response)
            if (entry.dispatch) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Narrative (AI Response)</div>
                        <div class="history-detail-value">${escapeHtml(entry.dispatch)}</div>
                    </div>
                `;
            }
            
            // Vision Dispatch (Image Description)
            if (entry.vision_dispatch) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Vision Description</div>
                        <div class="history-detail-value">${escapeHtml(entry.vision_dispatch)}</div>
                    </div>
                `;
            }
            
            // Vision Analysis (Gemini Vision AI sees what's actually in the image)
            if (entry.vision_analysis) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">üîç Vision AI Analysis (What Gemini Actually Sees)</div>
                        <div class="history-detail-value" style="background: rgba(78, 205, 196, 0.1); padding: 12px; border-left: 3px solid #4ecdc4; border-radius: 4px;">
                            ${escapeHtml(entry.vision_analysis)}
                        </div>
                    </div>
                `;
            }
            
            // Image Prompt
            if (entry.consequence_img_prompt || entry.image_prompt) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Image Generation Prompt</div>
                        <div class="history-detail-value">${escapeHtml(entry.consequence_img_prompt || entry.image_prompt)}</div>
                    </div>
                `;
            }
            
            // Generated Image
            if (entry.consequence_img_url || entry.image_url || entry.image) {
                const imageUrl = entry.consequence_img_url || entry.image_url || entry.image;
                const imageName = imageUrl.split('/').pop();
                const imageApiUrl = `${API_BASE}/sessions/${sessionId}/images/${imageName}`;
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Generated Image</div>
                        <div class="history-detail-value">
                            <div style="margin-top: 10px; text-align: center;">
                                <img src="${imageApiUrl}" 
                                     alt="${imageName}" 
                                     style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.5); cursor: pointer;"
                                     onclick="window.open('${imageApiUrl}', '_blank')"
                                     onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div style="display: none; color: #888; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top: 10px;">
                                    ‚ö†Ô∏è Image not found: ${imageName}<br>
                                    <a href="${imageApiUrl}" target="_blank" style="color: #4ecdc4; text-decoration: none;">
                                        Try direct link
                                    </a>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #888;">
                                    <a href="${imageApiUrl}" download="${imageName}" style="color: #4ecdc4; text-decoration: none;">
                                        ‚¨áÔ∏è Download Image
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Choices Presented
            if (entry.choices && entry.choices.length > 0) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Choices Presented</div>
                        <div class="history-detail-value">${entry.choices.map((c, i) => `${i + 1}. ${escapeHtml(c)}`).join('\n')}</div>
                    </div>
                `;
            }
            
            // Narrative Prompt (what was sent to AI)
            if (entry.narrative_prompt) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Narrative Generation Prompt</div>
                        <div class="history-detail-value">${escapeHtml(entry.narrative_prompt)}</div>
                    </div>
                `;
            }
            
            // Choices Prompt
            if (entry.choices_prompt) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Choices Generation Prompt</div>
                        <div class="history-detail-value">${escapeHtml(entry.choices_prompt)}</div>
                    </div>
                `;
            }
            
            // Location
            if (entry.location) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Location</div>
                        <div class="history-detail-value">${escapeHtml(entry.location)}</div>
                    </div>
                `;
            }
            
            // Time of Day
            if (entry.time_of_day) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Time of Day</div>
                        <div class="history-detail-value">${escapeHtml(entry.time_of_day)}</div>
                    </div>
                `;
            }
            
            // Raw JSON (for deep debugging)
            html += `
                <div class="history-detail">
                    <div class="history-detail-label">Raw JSON (Full Entry)</div>
                    <div class="history-detail-value json">${syntaxHighlightJSON(entry)}</div>
                </div>
            `;
            
            return html;
        }

        // Toggle history entry expansion
        function toggleHistoryEntry(entryId) {
            const entry = document.getElementById(entryId);
            entry.classList.toggle('expanded');
        }

        // Expand all history entries
        function expandAllHistory() {
            document.querySelectorAll('.history-entry').forEach(entry => {
                entry.classList.add('expanded');
            });
        }

        // Collapse all history entries
        function collapseAllHistory() {
            document.querySelectorAll('.history-entry').forEach(entry => {
                entry.classList.remove('expanded');
            });
        }

        // Simple JSON syntax highlighting
        function syntaxHighlightJSON(obj) {
            const json = JSON.stringify(obj, null, 2);
            
            // Basic syntax highlighting
            return json
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                .replace(/: "([^"]*)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/: (\d+)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false|null)/g, ': <span class="json-boolean">$1</span>');
        }

        // Close modal on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Close modal on outside click
        document.getElementById('session-modal').addEventListener('click', (e) => {
            if (e.target.id === 'session-modal') closeModal();
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TAB SWITCHING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            const activeContent = document.getElementById(`tab-content-${tabName}`);
            activeContent.classList.add('active');
            activeContent.style.display = 'block';

            // Load data for the active tab
            if (tabName === 'archives') {
                refreshArchives();
            } else {
                refreshData();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ARCHIVE MANAGEMENT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Asset cache for images and tapes
        const assetCache = new Map();

        function getCachedAsset(url) {
            return assetCache.get(url);
        }

        function cacheAsset(url, blob) {
            assetCache.set(url, URL.createObjectURL(blob));
        }

        async function fetchArchives() {
            console.log(`[ARCHIVES] Fetching from: ${API_BASE}/archives`);
            const response = await fetch(`${API_BASE}/archives`);
            console.log(`[ARCHIVES] Response status: ${response.status}`);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const result = await response.json();
            return result.data;
        }

        async function refreshArchives() {
            console.log('[ARCHIVES] Refreshing archives list...');
            const loading = document.getElementById('archives-loading');
            const container = document.getElementById('archives-container');
            
            loading.style.display = 'block';
            container.innerHTML = '';

            try {
                const archives = await fetchArchives();
                console.log(`[ARCHIVES] Found ${archives.length} archives`);
                
                loading.style.display = 'none';

                if (archives.length === 0) {
                    container.innerHTML = '<div class="no-sessions">No archived games found</div>';
                    return;
                }

                archives.forEach(archive => {
                    const archiveCard = createArchiveCard(archive);
                    container.appendChild(archiveCard);
                });

                const now = new Date().toLocaleTimeString();
                document.getElementById('archives-last-updated').textContent = `Last updated: ${now}`;

            } catch (error) {
                console.error('[ARCHIVES] Error:', error);
                loading.style.display = 'none';
                showError(`Failed to load archives: ${error.message}`);
            }
        }

        function createArchiveCard(archive) {
            const card = document.createElement('div');
            card.className = 'session-card';
            
            // Parse timestamp
            const timestamp = archive.archive_timestamp || 'unknown';
            const date = timestamp !== 'unknown' ? formatArchiveTimestamp(timestamp) : 'Unknown date';
            
            // Reason badge
            const reasonColors = {
                'reset': 'var(--color-text-dim)',
                'death': 'var(--color-blood-red)',
                'manual_deletion': 'var(--color-warning)'
            };
            const reasonColor = reasonColors[archive.archive_reason] || 'var(--color-text-dim)';
            
            // Status indicator
            const isDead = archive.player_status === false;
            const statusClass = isDead ? 'status-dead' : 'status-alive';
            const statusText = isDead ? 'DEAD' : 'ALIVE';
            
            card.innerHTML = `
                <div class="session-header">
                    <div class="session-info">
                        <h3 class="session-id">${escapeHtml(archive.archive_name)}</h3>
                        <div class="session-meta">
                            <span style="color: ${reasonColor}; text-transform: uppercase;">
                                ${escapeHtml(archive.archive_reason.replace(/_/g, ' '))}
                            </span>
                            <span>‚Ä¢</span>
                            <span>${date}</span>
                            <span>‚Ä¢</span>
                            <span>${archive.turns_completed || 0} turns</span>
                        </div>
                    </div>
                    <div class="session-status ${statusClass}">${statusText}</div>
                </div>
                <div class="session-stats">
                    <div>
                        <span class="stat-label">Session:</span>
                        <span class="stat-value">${escapeHtml(archive.session_id || 'unknown')}</span>
                    </div>
                    <div>
                        <span class="stat-label">Final Location:</span>
                        <span class="stat-value">${escapeHtml(archive.final_location || 'unknown')}</span>
                    </div>
                    <div>
                        <span class="stat-label">History Entries:</span>
                        <span class="stat-value">${archive.total_history_entries || 0}</span>
                    </div>
                </div>
                <div class="session-actions">
                    <button class="btn btn-primary" onclick="viewArchive('${escapeHtml(archive.archive_name)}')">
                        üëÅ View Details
                    </button>
                    <button class="btn btn-danger" onclick="deleteArchive('${escapeHtml(archive.archive_name)}')">
                        üóë Delete Permanently
                    </button>
                </div>
            `;
            
            return card;
        }

        function formatArchiveTimestamp(timestamp) {
            // Format: YYYYMMDD_HHMMSS
            if (typeof timestamp === 'string' && timestamp.includes('_')) {
                const [datePart, timePart] = timestamp.split('_');
                const year = datePart.substring(0, 4);
                const month = datePart.substring(4, 6);
                const day = datePart.substring(6, 8);
                const hour = timePart.substring(0, 2);
                const minute = timePart.substring(2, 4);
                return `${year}-${month}-${day} ${hour}:${minute}`;
            }
            return timestamp;
        }

        async function viewArchive(archiveName) {
            console.log(`[ARCHIVES] Viewing archive: ${archiveName}`);
            
            try {
                const response = await fetch(`${API_BASE}/archives/${archiveName}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const result = await response.json();
                const archiveData = result.data;
                
                showArchiveModal(archiveName, archiveData);
                
            } catch (error) {
                console.error('[ARCHIVES] Error loading archive:', error);
                showError(`Failed to load archive: ${error.message}`);
            }
        }

        function showArchiveModal(archiveName, data) {
            const { metadata, state, history, asset_counts } = data;
            
            const modalBody = document.getElementById('modal-body');
            
            // Build detailed view similar to session modal
            let html = `
                <div class="card">
                    <div class="card-header">ARCHIVE METADATA</div>
                    <div class="session-stats" style="padding: 15px;">
                        <div>
                            <span class="stat-label">Archive Name:</span>
                            <span class="stat-value">${escapeHtml(archiveName)}</span>
                        </div>
                        <div>
                            <span class="stat-label">Original Session:</span>
                            <span class="stat-value">${escapeHtml(metadata.session_id || 'unknown')}</span>
                        </div>
                        <div>
                            <span class="stat-label">Archive Reason:</span>
                            <span class="stat-value">${escapeHtml(metadata.archive_reason || 'unknown')}</span>
                        </div>
                        <div>
                            <span class="stat-label">Archived At:</span>
                            <span class="stat-value">${formatArchiveTimestamp(metadata.archive_timestamp)}</span>
                        </div>
                        <div>
                            <span class="stat-label">Turns Completed:</span>
                            <span class="stat-value">${metadata.turns_completed || 0}</span>
                        </div>
                        <div>
                            <span class="stat-label">Player Status:</span>
                            <span class="stat-value ${metadata.player_status === false ? 'danger' : 'success'}">
                                ${metadata.player_status === false ? 'DEAD' : 'ALIVE'}
                            </span>
                        </div>
                        <div>
                            <span class="stat-label">Final Location:</span>
                            <span class="stat-value">${escapeHtml(metadata.final_location || 'unknown')}</span>
                        </div>
                        <div>
                            <span class="stat-label">Assets:</span>
                            <span class="stat-value">${asset_counts.images} images, ${asset_counts.tapes} tapes</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Death info if player died
            if (metadata.player_status === false && metadata.death_dispatch) {
                html += `
                    <div class="card" style="border-left: 3px solid var(--color-blood-red); margin-top: 20px;">
                        <div class="card-header" style="color: var(--color-blood-red);">‚ò† DEATH RECORD</div>
                        <div class="card-body">
                            <div style="margin-bottom: 10px;">
                                <span class="stat-label">Death Turn:</span>
                                <span class="stat-value">${metadata.death_turn}</span>
                            </div>
                            <div style="padding: 15px; background: rgba(220, 20, 60, 0.1); border-radius: 4px;">
                                ${escapeHtml(metadata.death_dispatch)}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Discovered Entities
            if (metadata.seen_elements && metadata.seen_elements.length > 0) {
                html += `
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(220, 20, 60, 0.08) 0%, rgba(0, 0, 0, 0.3) 100%); border: 2px solid var(--color-blood-red); margin: 20px 0; box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--color-border-red); padding-bottom: 10px;">
                            <div>
                                <div style="font-family: var(--font-ocr); color: var(--color-blood-red); font-size: 0.85rem; letter-spacing: 0.2em; text-transform: uppercase; text-shadow: 0 0 10px rgba(220, 20, 60, 0.5);">DISCOVERED ENTITIES</div>
                                <div style="font-family: var(--font-din); color: var(--color-text-dim); font-size: 0.7rem; margin-top: 4px; letter-spacing: 0.05em;">Significant objects, characters, and landmarks encountered</div>
                            </div>
                            <div style="font-family: var(--font-ocr); color: var(--color-blood-red); font-size: 1.5rem; padding: 8px 16px; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--color-border-red);">
                                ${metadata.seen_elements.length}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; padding: 5px;">
                            ${metadata.seen_elements.map((elem, idx) => `
                                <div style="
                                    background: rgba(0, 0, 0, 0.6); 
                                    border: 1px solid var(--color-border-red); 
                                    padding: 12px 14px; 
                                    font-size: 0.75rem; 
                                    font-family: var(--font-ocr); 
                                    color: var(--color-text-primary);
                                    position: relative;
                                    transition: all 0.2s ease;
                                    cursor: default;
                                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                                "
                                onmouseover="this.style.background='rgba(220, 20, 60, 0.15)'; this.style.borderColor='var(--color-blood-red)'; this.style.boxShadow='0 0 15px rgba(220, 20, 60, 0.4)';"
                                onmouseout="this.style.background='rgba(0, 0, 0, 0.6)'; this.style.borderColor='var(--color-border-red)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.3)';"
                                >
                                    <div style="position: absolute; top: 4px; right: 6px; font-size: 0.6rem; color: var(--color-blood-red); opacity: 0.5;">#${idx + 1}</div>
                                    <div style="line-height: 1.4; padding-top: 8px;">${escapeHtml(elem)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Full History
            html += `
                <div class="history-section" style="margin-top: 20px;">
                    <div class="history-header">
                        <h3 class="history-title">üìú Full History & Prompts</h3>
                        <div class="history-controls">
                            <button class="expand-all-btn" onclick="expandAllArchiveHistory()">Expand All</button>
                            <button class="collapse-all-btn" onclick="collapseAllArchiveHistory()">Collapse All</button>
                        </div>
                    </div>
                    <div id="archive-history-container"></div>
                </div>
            `;
            
            modalBody.innerHTML = html;
            document.getElementById('session-modal').classList.add('show');
            
            // Load history
            loadArchiveHistory(archiveName, history);
        }

        function loadArchiveHistory(archiveName, history) {
            const container = document.getElementById('archive-history-container');
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="no-data">No history available</div>';
                return;
            }
            
            container.innerHTML = history.map((entry, index) => {
                const turnNum = entry.turn_count || (index + 1);
                const isExpanded = index === history.length - 1; // Expand last turn by default
                
                return `
                    <div class="history-entry ${isExpanded ? 'expanded' : ''}">
                        <div class="history-entry-header" onclick="toggleArchiveHistoryEntry(this)">
                            <div class="turn-number">Turn ${turnNum}</div>
                            <div class="history-preview">${escapeHtml((entry.player_choice || entry.dispatch || '').substring(0, 80))}...</div>
                            <div class="expand-icon">${isExpanded ? '‚ñº' : '‚ñ∂'}</div>
                        </div>
                        <div class="history-entry-body" style="display: ${isExpanded ? 'block' : 'none'};">
                            ${buildArchiveHistoryEntryDetails(entry, archiveName)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function buildArchiveHistoryEntryDetails(entry, archiveName) {
            let html = '';
            
            // Player Choice
            if (entry.player_choice) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">üéÆ Player Choice</div>
                        <div class="history-detail-value">${escapeHtml(entry.player_choice)}</div>
                    </div>
                `;
            }
            
            // AI Response (Dispatch/Consequence)
            const response = entry.dispatch || entry.consequence || '';
            if (response) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">ü§ñ AI Response</div>
                        <div class="history-detail-value">${escapeHtml(response)}</div>
                    </div>
                `;
            }
            
            // Vision AI Analysis
            if (entry.vision_analysis) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">üîç Vision AI Analysis</div>
                        <div class="history-detail-value" style="background: rgba(78, 205, 196, 0.1); padding: 12px; border-left: 3px solid #4ecdc4; border-radius: 4px;">
                            ${escapeHtml(entry.vision_analysis)}
                        </div>
                    </div>
                `;
            }
            
            // Generated Image (with caching)
            if (entry.consequence_img_url || entry.image_url || entry.image) {
                const imageUrl = entry.consequence_img_url || entry.image_url || entry.image;
                const imageName = imageUrl.split('/').pop();
                const imageApiUrl = `${API_BASE}/archives/${archiveName}/images/${imageName}`;
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Generated Image</div>
                        <div class="history-detail-value">
                            <div style="margin-top: 10px; text-align: center;">
                                <img src="${imageApiUrl}" 
                                     alt="${imageName}" 
                                     style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.5); cursor: pointer;"
                                     onclick="window.open('${imageApiUrl}', '_blank')"
                                     onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div style="display: none; color: #888; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top: 10px;">
                                    ‚ö†Ô∏è Image not found: ${imageName}<br>
                                    <a href="${imageApiUrl}" target="_blank" style="color: #4ecdc4; text-decoration: none;">
                                        Try direct link
                                    </a>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #888;">
                                    <a href="${imageApiUrl}" download="${imageName}" style="color: #4ecdc4; text-decoration: none;">
                                        ‚¨áÔ∏è Download Image
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Choices Presented
            if (entry.choices && entry.choices.length > 0) {
                html += `
                    <div class="history-detail">
                        <div class="history-detail-label">Choices Presented</div>
                        <div class="history-detail-value">${entry.choices.map((c, i) => `${i + 1}. ${escapeHtml(c)}`).join('\n')}</div>
                    </div>
                `;
            }
            
            // Raw JSON
            html += `
                <div class="history-detail">
                    <div class="history-detail-label">Raw JSON (Full Entry)</div>
                    <div class="history-detail-value json">${syntaxHighlightJSON(entry)}</div>
                </div>
            `;
            
            return html;
        }

        function toggleArchiveHistoryEntry(header) {
            const entry = header.parentElement;
            const body = entry.querySelector('.history-entry-body');
            const icon = entry.querySelector('.expand-icon');
            
            if (entry.classList.contains('expanded')) {
                entry.classList.remove('expanded');
                body.style.display = 'none';
                icon.textContent = '‚ñ∂';
            } else {
                entry.classList.add('expanded');
                body.style.display = 'block';
                icon.textContent = '‚ñº';
            }
        }

        function expandAllArchiveHistory() {
            document.querySelectorAll('#archive-history-container .history-entry').forEach(entry => {
                entry.classList.add('expanded');
                entry.querySelector('.history-entry-body').style.display = 'block';
                entry.querySelector('.expand-icon').textContent = '‚ñº';
            });
        }

        function collapseAllArchiveHistory() {
            document.querySelectorAll('#archive-history-container .history-entry').forEach(entry => {
                entry.classList.remove('expanded');
                entry.querySelector('.history-entry-body').style.display = 'none';
                entry.querySelector('.expand-icon').textContent = '‚ñ∂';
            });
        }

        async function deleteArchive(archiveName) {
            if (!confirm(`Are you sure you want to PERMANENTLY delete archive "${archiveName}"?\n\nThis cannot be undone!`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/archives/${archiveName}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                console.log(`[ARCHIVES] Deleted: ${archiveName}`);
                refreshArchives();
                
            } catch (error) {
                console.error('[ARCHIVES] Error deleting archive:', error);
                showError(`Failed to delete archive: ${error.message}`);
            }
        }
    </script>
</body>
</html>

